name: WB Search Texts → Supabase (daily 07:00 MSK)

on:
  schedule:
    - cron: "0 4 * * *"   # 04:00 UTC == 07:00 MSK
  workflow_dispatch: {}

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Run sync
        env:
          SUPABASE_CONN: ${{ secrets.SUPABASE_CONN }}
          WB_SA_API_KEY: ${{ secrets.WB_SA_API_KEY }}
          TOP_ORDER_BY: "orders"
          INCLUDE_SUBSTITUTED: "true"
          INCLUDE_SEARCH_TEXTS: "true"
          TEXT_LIMIT: "30"
          USE_PAST_PERIOD: "false"
          DAYS_SHIFT: "1"
          # Опциональные фильтры:
          WB_FILTER_BRANDS: "MOORKA"
          WB_FILTER_SUBJECTS: "Костюм детский,Костюмы"
          WB_FILTER_VENDOR_CODES: ""
        run: |
          python wb_search_texts_sync.py
