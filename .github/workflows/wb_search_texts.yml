name: WB Search Texts ‚Üí Supabase (daily 07:00 MSK)

on:
  schedule:
    - cron: "0 4 * * *"      # 04:00 UTC == 07:00 MSK
  workflow_dispatch: {}      # —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ Actions

permissions:
  contents: read

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 90

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run sync script
        env:
          # üîê –°–µ–∫—Ä–µ—Ç—ã (–¥–æ–±–∞–≤—å –≤ Settings ‚Üí Secrets and variables ‚Üí Actions)
          SUPABASE_CONN: ${{ secrets.SUPABASE_CONN }}   # postgresql://postgres:<PWD>@aws-0-eu-north-1.pooler.supabase.com:6543/postgres?sslmode=require
          WB_SA_API_KEY: ${{ secrets.WB_SA_API_KEY }}   # HeaderApiKey –∏–∑ WB Seller Analytics

          # ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞
          TOP_ORDER_BY: "orders"                        # openCard|addToCart|openToCart|orders|cartToOrder
          INCLUDE_SUBSTITUTED: "true"
          INCLUDE_SEARCH_TEXTS: "true"
          TEXT_LIMIT: "30"                              # 100 –¥–ª—è —Ç–∞—Ä–∏—Ñ–∞ ¬´–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π¬ª
          USE_PAST_PERIOD: "false"
          DAYS_SHIFT: "1"                               # –±–µ—Ä—ë–º –≤—á–µ—Ä–∞ –ø–æ –ú–°–ö

          # üîé –§–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–∞ (–æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º–∏, —á—Ç–æ–±—ã —Ç—è–Ω—É—Ç—å –≤—Å—ë)
          WB_FILTER_BRANDS: ""                          # –Ω–∞–ø—Ä.: "moorka"
          WB_FILTER_SUBJECTS: ""                        # –Ω–∞–ø—Ä.: "–∫–æ—Å—Ç—é–º,–∫–æ—Å—Ç—é–º –¥–µ—Ç—Å–∫–∏–π"
          WB_FILTER_VENDOR_CODES: ""                    # –Ω–∞–ø—Ä.: "HPsetDark,HPsetBlack"
        run: |
          python wb_search_texts_sync.py
